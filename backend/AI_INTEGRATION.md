# ğŸ¤– AI åŠŸèƒ½é›†æˆæŒ‡å—

## åŠŸèƒ½æ¦‚è§ˆ

Ralendar é›†æˆäº†**é€šä¹‰åƒé—® API**ï¼Œæä¾›ä»¥ä¸‹æ™ºèƒ½åŠŸèƒ½ï¼š

### 1. æ™ºèƒ½æ—¥ç¨‹åˆ›å»º â­â­â­â­â­
- **åŠŸèƒ½**ï¼šè¾“å…¥è‡ªç„¶è¯­è¨€ï¼Œè‡ªåŠ¨è§£æä¸ºç»“æ„åŒ–æ—¥ç¨‹
- **API**: `POST /api/ai/parse-event/`
- **ç¤ºä¾‹**ï¼š
  ```
  è¾“å…¥: "æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼šï¼Œè®¨è®ºé¡¹ç›®æ–¹æ¡ˆ"
  è¾“å‡º: {
    "title": "é¡¹ç›®æ–¹æ¡ˆè®¨è®ºä¼šè®®",
    "date": "2025-11-13",
    "time": "15:00",
    "description": "è®¨è®ºé¡¹ç›®æ–¹æ¡ˆ",
    "reminder_minutes": 15
  }
  ```

### 2. æ—¥ç¨‹æ™ºèƒ½æ€»ç»“ â­â­â­â­
- **åŠŸèƒ½**ï¼šæ€»ç»“ä»Šå¤©/æœ¬å‘¨/æœ¬æœˆçš„æ—¥ç¨‹å®‰æ’
- **API**: `POST /api/ai/summarize/`
- **ä½¿ç”¨åœºæ™¯**ï¼š
  - æ¯æ—¥æ—©æ™¨æŸ¥çœ‹ä»Šæ—¥å®‰æ’
  - å‘¨æŠ¥ç”Ÿæˆ
  - æ—¶é—´ç®¡ç†ä¼˜åŒ–å»ºè®®

### 3. å¯¹è¯å¼æ—¥ç¨‹ç®¡ç† â­â­â­â­â­
- **åŠŸèƒ½**ï¼šé€šè¿‡èŠå¤©æ–¹å¼ç®¡ç†æ—¥ç¨‹
- **API**: `POST /api/ai/chat/`
- **ç¤ºä¾‹å¯¹è¯**ï¼š
  ```
  ç”¨æˆ·: "å¸®æˆ‘çœ‹çœ‹ä¸‹å‘¨æœ‰ä»€ä¹ˆå®‰æ’ï¼Ÿ"
  AI: "ä¸‹å‘¨æ‚¨æœ‰3ä¸ªä¼šè®®å’Œ2ä¸ªå¾…åŠäº‹é¡¹..."
  
  ç”¨æˆ·: "æé†’æˆ‘æ˜å¤©ç»™å¦ˆå¦ˆä¹°ç”Ÿæ—¥ç¤¼ç‰©"
  AI: "å¥½çš„ï¼Œæˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†æé†’..."
  ```

## é…ç½®æ­¥éª¤

### 1. è·å–é€šä¹‰åƒé—® API Key

1. è®¿é—® https://dashscope.aliyun.com/
2. æ³¨å†Œ/ç™»å½•é˜¿é‡Œäº‘è´¦å·
3. å¼€é€š **DashScope** æœåŠ¡
4. åˆ›å»º API Key
5. å¤åˆ¶ API Keyï¼ˆæ ¼å¼ï¼š`sk-xxxxx`ï¼‰

### 2. é…ç½®åç«¯

åœ¨ `backend/.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```bash
QWEN_API_KEY=sk-your-actual-api-key-here
```

### 3. é‡å¯æœåŠ¡

```bash
cd ~/kotlin_calendar/backend
sudo systemctl restart gunicorn
```

## API æ–‡æ¡£

### 1. è§£æè‡ªç„¶è¯­è¨€åˆ›å»ºæ—¥ç¨‹

**ç«¯ç‚¹**: `POST /api/ai/parse-event/`

**è¯·æ±‚**:
```json
{
  "text": "æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼šï¼Œè®¨è®ºé¡¹ç›®æ–¹æ¡ˆ"
}
```

**å“åº”**:
```json
{
  "success": true,
  "event": {
    "title": "é¡¹ç›®æ–¹æ¡ˆè®¨è®ºä¼šè®®",
    "date": "2025-11-13",
    "time": "15:00",
    "description": "è®¨è®ºé¡¹ç›®æ–¹æ¡ˆ",
    "reminder_minutes": 15
  }
}
```

### 2. æ—¥ç¨‹æ€»ç»“

**ç«¯ç‚¹**: `POST /api/ai/summarize/`

**è¯·æ±‚**:
```json
{
  "events": [
    {"title": "ä¼šè®®A", "dateTime": "2025-11-13T10:00:00"},
    {"title": "ä¼šè®®B", "dateTime": "2025-11-13T15:00:00"}
  ],
  "date_range": "today"
}
```

**å“åº”**:
```json
{
  "success": true,
  "summary": "ğŸ“Š ä»Šå¤©æ‚¨æœ‰2ä¸ªä¼šè®®å®‰æ’...\nå»ºè®®ï¼šåˆä¼‘æ—¶é—´è¾ƒçŸ­ï¼Œæ³¨æ„ä¼‘æ¯ã€‚"
}
```

### 3. AI èŠå¤©

**ç«¯ç‚¹**: `POST /api/ai/chat/`

**è¯·æ±‚**:
```json
{
  "message": "å¸®æˆ‘çœ‹çœ‹ä¸‹å‘¨æœ‰ä»€ä¹ˆå®‰æ’ï¼Ÿ",
  "context": {
    "current_date": "2025-11-12",
    "events": [...]
  }
}
```

**å“åº”**:
```json
{
  "success": true,
  "reply": "ä¸‹å‘¨æ‚¨æœ‰3ä¸ªä¼šè®®..."
}
```

## è´¹ç”¨è¯´æ˜

é€šä¹‰åƒé—® API æ”¶è´¹æ ‡å‡†ï¼š
- **qwen-turbo**: Â¥0.8 / 1M tokensï¼ˆé€‚åˆæ—¥å¸¸ä½¿ç”¨ï¼‰
- **qwen-plus**: Â¥4 / 1M tokensï¼ˆæ›´å¼ºæ€§èƒ½ï¼‰
- **qwen-max**: Â¥40 / 1M tokensï¼ˆæœ€å¼ºæ€§èƒ½ï¼‰

**æˆæœ¬ä¼°ç®—**ï¼ˆä½¿ç”¨ qwen-turboï¼‰ï¼š
- å•æ¬¡æ—¥ç¨‹è§£æï¼šçº¦ 100-200 tokens â‰ˆ Â¥0.0002
- 100æ¬¡æ—¥ç¨‹è§£æï¼šçº¦ Â¥0.02
- 1000æ¬¡ä½¿ç”¨ï¼šçº¦ Â¥0.20

**å»ºè®®**ï¼š
- æ—¥å¸¸ä½¿ç”¨ï¼šqwen-turboï¼ˆæ€§ä»·æ¯”æœ€é«˜ï¼‰
- å¤æ‚ä»»åŠ¡ï¼šqwen-plus
- è®¾ç½®æ¯æ—¥è°ƒç”¨ä¸Šé™

## Android ç«¯é›†æˆç¤ºä¾‹

```kotlin
// æ™ºèƒ½åˆ›å»ºæ—¥ç¨‹
suspend fun parseEventFromText(text: String): EventData? {
    val response = RetrofitClient.api.parseEventFromText(text)
    if (response.success) {
        return response.event
    }
    return null
}

// ä½¿ç”¨ç¤ºä¾‹
lifecycleScope.launch {
    val userInput = "æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š"
    val event = parseEventFromText(userInput)
    
    if (event != null) {
        // è‡ªåŠ¨å¡«å……è¡¨å•
        editTextTitle.setText(event.title)
        editTextDate.setText(event.date)
        editTextTime.setText(event.time)
    }
}
```

## å®‰å…¨å»ºè®®

1. **API Key å®‰å…¨**ï¼š
   - âŒ ä¸è¦åœ¨Androidä»£ç ä¸­ç¡¬ç¼–ç 
   - âœ… åªå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯
   - âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡

2. **è®¿é—®æ§åˆ¶**ï¼š
   - âœ… æ‰€æœ‰AI APIéƒ½è¦æ±‚ç”¨æˆ·ç™»å½•ï¼ˆIsAuthenticatedï¼‰
   - âœ… é˜²æ­¢æ»¥ç”¨å’Œæ¶æ„è°ƒç”¨

3. **æˆæœ¬æ§åˆ¶**ï¼š
   - è®¾ç½®æ¯ç”¨æˆ·æ¯æ—¥è°ƒç”¨æ¬¡æ•°é™åˆ¶
   - è®°å½•APIè°ƒç”¨æ—¥å¿—
   - ç›‘æ§è´¹ç”¨å¼‚å¸¸

## ä¸‹ä¸€æ­¥å¼€å‘

### ä¼˜å…ˆçº§ 1ï¸âƒ£
- [ ] Android UIï¼šæ·»åŠ "AIåŠ©æ‰‹"æŒ‰é’®
- [ ] é›†æˆè¯­éŸ³è¾“å…¥
- [ ] ä¼˜åŒ–AIæç¤ºè¯

### ä¼˜å…ˆçº§ 2ï¸âƒ£
- [ ] æ·»åŠ æ—¥ç¨‹å†²çªæ£€æµ‹
- [ ] æ™ºèƒ½æé†’æ—¶é—´å»ºè®®
- [ ] å‘¨æŠ¥/æœˆæŠ¥è‡ªåŠ¨ç”Ÿæˆ

### ä¼˜å…ˆçº§ 3ï¸âƒ£
- [ ] å¤šè½®å¯¹è¯æ”¯æŒ
- [ ] ä¸ªæ€§åŒ–æ¨è
- [ ] æ—¥ç¨‹æ¨¡æ¿åº“

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: API è°ƒç”¨å¤±è´¥

**é”™è¯¯**: `æœªé…ç½®é€šä¹‰åƒé—®APIå¯†é’¥`

**è§£å†³**:
1. æ£€æŸ¥ `.env` æ–‡ä»¶
2. ç¡®è®¤ç¯å¢ƒå˜é‡åŠ è½½
3. é‡å¯æœåŠ¡

### é—®é¢˜ 2: è§£æç»“æœä¸å‡†ç¡®

**åŸå› **: æç¤ºè¯éœ€è¦ä¼˜åŒ–

**è§£å†³**:
1. ä¿®æ”¹ `ai_assistant.py` ä¸­çš„ `system_prompt`
2. æ·»åŠ æ›´å¤šç¤ºä¾‹
3. ä½¿ç”¨ qwen-plus æ¨¡å‹

### é—®é¢˜ 3: å“åº”é€Ÿåº¦æ…¢

**ä¼˜åŒ–æ–¹æ¡ˆ**:
1. ä½¿ç”¨ qwen-turbo æ¨¡å‹
2. å‡å°‘ä¸Šä¸‹æ–‡é•¿åº¦
3. æ·»åŠ ç¼“å­˜æœºåˆ¶

