# 8. 视图模式架构图详解

## 📖 这个图讲的是什么？

这个图展示了**三种日历视图模式的架构**，就像三种不同视角的展示方式。它告诉我们月视图、周视图、日视图是如何组织的，使用了哪些组件来显示数据。

## 🔍 五个组成部分

### 1️⃣ 视图控制器（View Controller）
**作用**：控制整个页面和视图切换

- **MainActivity**：主活动，负责控制整个主界面

**简单理解**：这是"总指挥"，决定显示哪个视图，控制视图之间的切换。

### 2️⃣ 视图模式（View Modes）
**作用**：三种不同的日历显示模式

- **月视图（MonthView）**：显示整月的日历
- **周视图（WeekView）**：显示一周的日历和时间线
- **日视图（DayView）**：显示一天的详细时间线

**简单理解**：这是"三种展示方式"，就像看地图可以看全貌、看区域、看细节。

### 3️⃣ 日历组件（Calendar Components）
**作用**：实际显示日历的UI组件

- **CalendarView**：月视图组件（显示整月）
- **WeekCalendarView**：周日历组件（显示一周的选择器）
- **RecyclerView**：列表视图组件（显示时间线和日程列表）

**简单理解**：这是"展示工具"，就像三种不同的展示架，用来展示不同的内容。

### 4️⃣ 适配器（Adapter）
**作用**：把数据转换成界面可以显示的格式

- **EventAdapter**：日程列表适配器（用于月视图的日程列表）
- **TimeSlotAdapter**：时间线适配器（用于周视图和日视图的时间线）

**简单理解**：这是"数据转换器"，把日程数据转换成界面上的列表项或时间线项。

### 5️⃣ 数据源（Data Source）
**作用**：提供数据的来源

- **EventRepository**：日程数据仓库

**简单理解**：这是"数据仓库"，所有的日程数据都从这里获取。

## 🔗 依赖关系（箭头表示使用关系）

### 视图控制器与视图模式
```
MainActivity → 月视图（可以切换到月视图）
MainActivity → 周视图（可以切换到周视图）
MainActivity → 日视图（可以切换到日视图）
```

**简单理解**：MainActivity 就像"遥控器"，可以切换到三种不同的视图模式。

### 视图模式与日历组件
```
月视图 → CalendarView（使用日历组件显示整月）
月视图 → EventAdapter（使用适配器显示日程列表）

周视图 → WeekCalendarView（使用周日历组件显示一周选择器）
周视图 → TimeSlotAdapter（使用时间线适配器显示时间线）

日视图 → RecyclerView（使用列表组件显示时间线）
日视图 → TimeSlotAdapter（使用时间线适配器显示时间线）
```

**简单理解**：每种视图模式使用不同的组件来展示，就像不同的展示方式需要不同的展示工具。

### 日历组件与数据源
```
CalendarView → EventRepository（从数据仓库获取日程数据）
WeekCalendarView → EventRepository（从数据仓库获取日程数据）
RecyclerView → EventRepository（从数据仓库获取日程数据）
```

**简单理解**：所有的日历组件都需要从同一个数据仓库获取数据，保证数据的一致性。

### 适配器与数据源
```
EventAdapter → EventRepository（从数据仓库获取日程数据）
TimeSlotAdapter → EventRepository（从数据仓库获取日程数据）
```

**简单理解**：适配器也需要从数据仓库获取数据，然后把数据转换成界面元素。

## 💡 举个例子理解视图模式

**场景一**：用户查看月视图

1. **MainActivity** 启动，默认显示**月视图**
2. 月视图使用 **CalendarView** 显示整月的日历网格
3. CalendarView 从 **EventRepository** 获取所有日程数据
4. 在日历上标记有日程的日期（显示圆点或其他标记）
5. 底部使用 **EventAdapter** 显示选中日期的日程列表
6. EventAdapter 也从 **EventRepository** 获取日程数据

**简单理解**：就像看月历，先用大视图看整月（CalendarView），然后看某一天的具体安排（EventAdapter）。

**场景二**：用户切换到周视图

1. 用户在 **MainActivity** 点击"周视图"按钮
2. MainActivity 切换到**周视图**模式
3. 周视图使用 **WeekCalendarView** 显示一周的日期选择器（横向7天）
4. 周视图使用 **RecyclerView** 显示时间线（24小时）
5. **TimeSlotAdapter** 把日程数据转换成时间线上的时间段
6. 所有组件都从 **EventRepository** 获取数据

**简单理解**：就像看周计划表，上面是日期选择（WeekCalendarView），下面是时间线（RecyclerView + TimeSlotAdapter）。

**场景三**：用户切换到日视图

1. MainActivity 切换到**日视图**模式
2. 日视图只显示当天的详细时间线
3. 使用 **RecyclerView** 显示24小时的时间线
4. **TimeSlotAdapter** 把日程转换成时间段显示
5. 数据同样来自 **EventRepository**

**简单理解**：就像看一天的时间表，详细显示每个时间段（RecyclerView + TimeSlotAdapter）。

## 🔄 三种视图模式的区别

### 月视图（MonthView）
- **组件**：CalendarView（日历网格）
- **适配器**：EventAdapter（日程列表）
- **特点**：看整月，适合快速浏览

### 周视图（WeekView）
- **组件**：WeekCalendarView（日期选择器）+ RecyclerView（时间线）
- **适配器**：TimeSlotAdapter（时间线适配器）
- **特点**：看一周，适合查看一周的安排

### 日视图（DayView）
- **组件**：RecyclerView（时间线）
- **适配器**：TimeSlotAdapter（时间线适配器）
- **特点**：看一天，适合查看详细的日程安排

## 🎯 为什么需要三种视图？

1. **不同场景**：
   - 月视图：快速浏览整月安排
   - 周视图：查看一周的工作安排
   - 日视图：查看某天的详细时间表

2. **用户体验**：
   - 不同需求使用不同视图
   - 可以在三种视图之间快速切换

3. **数据共享**：
   - 三种视图使用同一个数据源（EventRepository）
   - 保证数据的一致性

## 📊 数据流向

```
EventRepository（数据仓库）
    ↓
    ├──→ CalendarView（月视图）
    ├──→ WeekCalendarView（周视图）
    ├──→ RecyclerView（日视图）
    ├──→ EventAdapter（月视图列表）
    └──→ TimeSlotAdapter（周/日视图时间线）
```

**简单理解**：就像自来水管道，从总水管（EventRepository）分出多条支管（各种视图和适配器），供应给不同的地方。

## 🔄 视图切换

```
MainActivity（视图控制器）
    ↓
用户点击切换按钮
    ↓
MainActivity 切换视图模式
    ↓
不同的视图模式使用不同的组件
    ↓
所有组件都从同一个数据源获取数据
```

**简单理解**：就像看电视换台，你按遥控器（MainActivity）换台，不同的频道（视图模式）使用不同的显示方式，但节目内容（数据）都来自同一个电视台（EventRepository）。

## 📝 总结

这个图展示了视图模式的架构：

- **视图控制器**：总指挥（MainActivity），控制视图切换
- **视图模式**：三种展示方式（月/周/日视图）
- **日历组件**：展示工具（CalendarView、WeekCalendarView、RecyclerView）
- **适配器**：数据转换器（EventAdapter、TimeSlotAdapter）
- **数据源**：数据仓库（EventRepository），统一的数据来源

就像三种不同的"视角"：
- **月视图** = 俯瞰（看全貌）
- **周视图** = 平视（看区域）
- **日视图** = 放大（看细节）

它们使用不同的工具（组件）和转换方式（适配器），但都从同一个数据源获取数据，给用户提供灵活、便捷的日历查看体验！
