# 1. 系统整体架构图详解

## 📖 这个图讲的是什么？

这个图就像我们看房子的**整体设计图**，它展示了整个日历应用是由哪些"楼层"组成的，以及这些楼层之间是如何连接的。

## 🏗️ 四层结构（从外到内）

### 1️⃣ UI层（用户看到的界面）
**作用**：用户能直接看到和操作的界面
- **MainActivity**：主界面，就是打开应用看到的日历页面
- **SubscriptionsActivity**：订阅管理界面
- **FestivalDetailActivity**：节日详情界面
- **MapPickerActivity**：地图选择界面
- **EventAdapter**：日程列表的显示组件
- **TimeSlotAdapter**：时间线的显示组件

**简单理解**：这是"门面"，用户只能看到这一层。

### 2️⃣ 业务逻辑层（大脑）
**作用**：处理各种业务逻辑，做决策和计算
- **EventRepository**：日程数据管理器（增删改查日程）
- **ReminderManager**：提醒管理器（设置闹钟）
- **HolidayManager**：节假日管理器（获取节假日信息）
- **WeatherManager**：天气管理器（获取天气信息）
- **FortuneManager**：运势管理器（获取运势信息）
- **AIAssistant**：AI助手（智能对话）

**简单理解**：这是"大脑"，负责思考和处理各种事情。

### 3️⃣ 数据层（仓库）
**作用**：存储和获取数据
- **Room Database**：本地数据库（存日程数据）
- **EventDao**：日程数据访问接口
- **SubscriptionDao**：订阅数据访问接口
- **SharedPreferences**：简单配置存储（存用户设置）
- **RetrofitClient**：网络请求客户端
- **CalendarApi**：日历API接口

**简单理解**：这是"仓库"，存东西和取东西的地方。

### 4️⃣ 外部服务（第三方工具）
**作用**：应用需要的外部服务
- **Backend API**：后端服务器接口
- **AlarmManager**：系统闹钟服务
- **Notification**：系统通知服务
- **百度地图SDK**：地图服务

**简单理解**：这是"外部工具"，需要借助别人的力量。

## 🔄 数据流向（箭头表示谁调用谁）

```
用户操作界面 → UI层
    ↓
UI层调用 → 业务逻辑层
    ↓
业务逻辑层调用 → 数据层
    ↓
数据层调用 → 外部服务
```

## 💡 举个例子

**场景**：用户添加一个新日程

1. 用户在**UI层**的 MainActivity 点击"添加日程"按钮
2. MainActivity 调用**业务逻辑层**的 EventRepository 保存日程
3. EventRepository 调用**数据层**的 EventDao 写入数据库
4. 如果是云端模式，还会通过 RetrofitClient 调用**外部服务**的 Backend API

## 🎯 为什么要这样设计？

- **分工明确**：每层只负责自己的事情
- **易于维护**：修改UI不影响数据，修改数据不影响业务逻辑
- **便于扩展**：可以轻松添加新功能，不影响其他部分

## 📝 总结

这个架构图就像盖房子的图纸：
- **UI层** = 房子的外观（用户看到的部分）
- **业务逻辑层** = 房子的内部结构（处理逻辑）
- **数据层** = 房子的地下室（存储数据）
- **外部服务** = 房子的水电系统（需要的外部支持）

每一层各司其职，相互配合，共同构建出一个完整的应用！

