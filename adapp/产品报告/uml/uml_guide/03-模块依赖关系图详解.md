# 3. 模块依赖关系图详解

## 📖 这个图讲的是什么？

这个图展示了应用中**各个模块之间谁依赖谁**，就像一张"关系网"。如果一个模块指向另一个模块，说明第一个模块需要用到第二个模块。

## 🔍 四个模块包

### 1️⃣ 核心模块（Core Module）
**作用**：应用最基础的、最核心的部分

- **MainActivity**：主界面
- **EventRepository**：日程数据仓库
- **EventDao**：日程数据访问接口
- **Event**：日程数据模型（日程的基本信息）

**简单理解**：这是"房子的地基"，其他所有东西都依赖它。

### 2️⃣ 功能模块（Feature Module）
**作用**：实现各种具体功能的模块

- **ReminderManager**：提醒管理器
- **SubscriptionManager**：订阅管理器
- **HolidayManager**：节假日管理器
- **WeatherManager**：天气管理器
- **FortuneManager**：运势管理器
- **FestivalSubscriptionManager**：节日订阅管理器

**简单理解**：这是"房子的各个房间"，每个房间有不同功能。

### 3️⃣ 网络模块（Network Module）
**作用**：负责和服务器通信的部分

- **RetrofitClient**：网络请求客户端（发送HTTP请求的工具）
- **CalendarApi**：日历API接口
- **EventService**：日程服务接口
- **HolidayService**：节假日服务接口
- **AIService**：AI服务接口

**简单理解**：这是"房子的电话线"，负责和外界通信。

### 4️⃣ 数据存储（Data Storage）
**作用**：真正存储数据的地方

- **Room Database**：本地数据库（存复杂数据）
- **SharedPreferences**：简单配置存储（存用户设置）

**简单理解**：这是"房子的仓库"，存放各种东西。

## 🔗 依赖关系（箭头表示依赖）

### 核心模块的依赖
```
MainActivity 依赖：
  → EventRepository（需要数据仓库）
  → ReminderManager（需要提醒功能）
  → HolidayManager（需要节假日功能）
  → WeatherManager（需要天气功能）
  → FortuneManager（需要运势功能）

EventRepository 依赖：
  → EventDao（需要访问数据库）
  → CalendarApi（需要调用网络接口）
```

**简单理解**：MainActivity 就像"主控制室"，需要调用各种管理器来完成工作。

### 功能模块的依赖
```
SubscriptionManager 依赖：
  → CalendarApi（需要网络接口获取订阅数据）
  → SubscriptionDao（需要保存订阅到数据库）

HolidayManager 依赖：
  → CalendarApi（需要网络接口获取节假日数据）
  → FestivalSubscriptionManager（需要节日订阅功能）
  → SharedPreferences（需要保存用户设置）

ReminderManager 依赖：
  → Room Database（需要从数据库读取日程来设置提醒）
```

**简单理解**：各个功能模块都需要数据支持，要么从网络获取，要么从数据库读取。

### 网络模块的依赖
```
CalendarApi 依赖：
  → RetrofitClient（需要网络请求工具）
  → EventService（需要日程服务）
  → HolidayService（需要节假日服务）
  → AIService（需要AI服务）

RetrofitClient 依赖：
  → Room Database（可能需要缓存数据）
```

**简单理解**：网络模块是一个"中转站"，它使用 RetrofitClient 这个工具来调用各种服务。

### 数据存储的依赖
```
EventDao 依赖：
  → Room Database（需要数据库）
  → Event（需要数据模型）

SubscriptionDao 依赖：
  → Room Database（需要数据库）
  → Subscription（需要订阅数据模型）
```

**简单理解**：数据访问接口就像是"仓库管理员"，它知道怎么从仓库（数据库）里存取东西（数据模型）。

## 💡 举个例子理解依赖

**场景**：主界面显示日程列表

1. **MainActivity** 需要显示日程
2. 它**依赖** **EventRepository** 来获取日程数据
3. EventRepository **依赖** **EventDao** 来访问数据库
4. EventDao **依赖** **Room Database** 来真正读取数据
5. 同时，EventRepository 还**依赖** **CalendarApi** 来同步云端数据

**简单理解**：就像做菜，你需要调料（依赖），调料需要从商店买（依赖商店），商店需要从仓库拿货（依赖仓库）。

## ⚠️ 依赖的方向性

- **箭头指向**：表示"谁依赖谁"
- **不能循环依赖**：A依赖B，B不能依赖A（会死循环）
- **单向依赖**：依赖关系是单向的，像水流一样

## 🎯 为什么要这样设计？

1. **模块化**：每个模块职责明确，互不干扰
2. **可维护性**：修改一个模块，不影响其他模块
3. **可测试性**：可以单独测试每个模块
4. **可扩展性**：可以轻松添加新模块

## 📝 总结

这个图告诉我们：
- **谁需要谁**：哪些模块依赖哪些模块
- **依赖层次**：核心模块在底层，功能模块在上层
- **避免循环**：依赖关系是单向的，像金字塔一样

就像公司的组织架构，老板（MainActivity）需要各部门（功能模块），各部门需要数据支持（网络模块和数据存储），最终形成一个完整的工作体系！
